---
# This page was generated by a tool - https://github.com/KnightOS/kdoc
title: Decimal Floating Point Documentation
layout: documentation
---


<p>The kernel provides functions for working with BCD-encoded floating point numbers. These are slower than binary floats but have greater accuracy in base 10. A binary floating point implementation are available in <a href="https://github.com/KnightOS/libc">libc</a>.</p>


<div class="row">
    <div class="col-md-8">
        <h1>Decimal Floating Point</h1>
        <div class="docs">
            
            <div id="fpAbs" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpAbs">fpAbs</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L756">View Source</a></small>
                    </h2>
                    
                    <p>Takes the absolute value of the floating point number at IX.</p>

                    <div class="details">
                    
                    
                        <h3>Input</h3>
                        
                            <p>IX: Pointer to operand</p>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>IX: Pointer to result</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpAdd" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpAdd">fpAdd</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L806">View Source</a></small>
                    </h2>
                    
                    <p>Adds the two floating point numbers.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IX, IY</dt>
                                <dd><p>Pointers to operands</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Pointer to destination buffer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>May destroy one or both operands.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpAnd" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpAnd">fpAnd</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L999">View Source</a></small>
                    </h2>
                    
                    <p>Performs a logical AND on the two floating point numbers.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IX, IY</dt>
                                <dd><p>Pointers to operands</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>Z: Result was false 
 NZ: Result was true</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpCompare" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpCompare">fpCompare</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L1105">View Source</a></small>
                    </h2>
                    
                    <p>Compares the two floating point numbers.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IX, IY</dt>
                                <dd><p>Pointers to operands</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>Same as z80 CP instruction.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpFPart" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpFPart">fpFPart</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L1295">View Source</a></small>
                    </h2>
                    
                    <p>Calculates the fractional part of a floating point number, similar to TI-OS's <code>fPart()</code> command.</p>

                    <div class="details">
                    
                    
                        <h3>Input</h3>
                        
                            <p>IX: Pointer to operand</p>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>IX: Pointer to result</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpIPart" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpIPart">fpIPart</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L1237">View Source</a></small>
                    </h2>
                    
                    <p>Calculates the integer part of a floating point number, similar to TI-OS's <code>iPart()</code> command.</p>

                    <div class="details">
                    
                    
                        <h3>Input</h3>
                        
                            <p>IX: Pointer to operand</p>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>IX: Pointer to result</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpLdConst" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpLdConst">fpLdConst</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L606">View Source</a></small>
                    </h2>
                    
                    <p>Loads a floating point constant specified by A into HL.</p>

                    <div class="details">
                    
                    
                        <h3>Input</h3>
                        
                            <p>A: Constant to load, use <code>FP_*</code> macros from kernel.inc 
 HL: Pointer to destination buffer</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpMax" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpMax">fpMax</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L1170">View Source</a></small>
                    </h2>
                    
                    <p>Finds the maximum of the two floating point numbers.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IX, IY</dt>
                                <dd><p>Pointers to operands</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>HL: Pointer to maximum</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpMin" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpMin">fpMin</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L1155">View Source</a></small>
                    </h2>
                    
                    <p>Finds the minimum of the two floating point numbers.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IX, IY</dt>
                                <dd><p>Pointer to operands</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>HL: Pointer to minimum</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpMulPow10" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpMulPow10">fpMulPow10</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L976">View Source</a></small>
                    </h2>
                    
                    <p>Multiplies the floating point number in IX by 10^E.</p>

                    <div class="details">
                    
                    
                        <h3>Input</h3>
                        
                            <p>IX: Pointer to operand 
 E: Signed exponent (i.e. 2 -&gt; 100, 3 -&gt; 0.001)</p>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>IX: Pointer to result</p>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>Does not check for overflow.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpNeg" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpNeg">fpNeg</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L766">View Source</a></small>
                    </h2>
                    
                    <p>Negates the floating point number at IX.</p>

                    <div class="details">
                    
                    
                        <h3>Input</h3>
                        
                            <p>IX: Pointer to operand</p>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>IX: Pointer to result</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpNot" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpNot">fpNot</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L1080">View Source</a></small>
                    </h2>
                    
                    <p>Performs a logical NOT on the floating point number.</p>

                    <div class="details">
                    
                    
                        <h3>Input</h3>
                        
                            <p>IX: Pointer to operand</p>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>Z: Result was false 
 NZ: Result was true</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpOr" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpOr">fpOr</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L1023">View Source</a></small>
                    </h2>
                    
                    <p>Performs a logical OR on the two floating point numbers.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IX, IY</dt>
                                <dd><p>Pointers to operands</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>Z: Result was false 
 NZ: Result was true</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpRand" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpRand">fpRand</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L1185">View Source</a></small>
                    </h2>
                    
                    <p>Generates a random floating point number between 0 and 1, similar to TI-OS's <code>rand</code> command.</p>

                    <div class="details">
                    
                    
                        <h3>Input</h3>
                        
                            <p>HL: Pointer to output</p>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>Uses <code>getRandom</code> to generate the digits, so it is not cryptographically 
 random.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpSub" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpSub">fpSub</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L786">View Source</a></small>
                    </h2>
                    
                    <p>Subtracts the two floating point numbers.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IY</dt>
                                <dd><p>Pointer to operand 2 (subtrahend)</p></dd>
                                
                                <dt>IX</dt>
                                <dd><p>Pointer to operand 1 (minuend)</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Pointer to destination buffer</p></dd>
                                
                            </dl>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fpXor" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fpXor">fpXor</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L1046">View Source</a></small>
                    </h2>
                    
                    <p>Performs a logical XOR on the two floating point numbers.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IX, IY</dt>
                                <dd><p>Pointers to operands</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>Z: Result was false 
 NZ: Result was true</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="fptostr" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#fptostr">fptostr</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L266">View Source</a></small>
                    </h2>
                    
                    <p>Converts a floating point number into an ASCII-encoded decimal string.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>Flags / digits</p></dd>
                                
                                <dt>IX</dt>
                                <dd><p>Pointer to floating point number</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Pointer to destination buffer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>The destination buffer must be at least 20 characters in length. </p>
<p>The most significant nibble of A should be set to flags. <code>FP_STR_*</code> 
 macros in kernel.inc can be ORed and stored in A for convenience. </p>
<p>The least significant nibble of A is the number of digits to display 
 after the decimal: 0-9 for that many digits, or 0xF for as many are 
 non-zero. </p>
<p>Examples: </p>
<p>All nonzero decimals in scientific notation, with decimal as ',': </p>
<p>ld a, FP_STR_INV_PUNC | FP_DISP_SCIENTIFIC | 0xF </p>
<p>5 fixed digits grouped with ',': </p>
<p>ld a, FP_GROUP_DIGITS | 5</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="itofp" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#itofp">itofp</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L13">View Source</a></small>
                    </h2>
                    
                    <p>Converts a 32-bit unsigned integer into a floating-point binary coded decimal format and stores it to the buffer at HL.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>HL</dt>
                                <dd><p>Pointer to 9-byte destination buffer</p></dd>
                                
                                <dt>ACIX</dt>
                                <dd><p>Unsigned integer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>The result is in the following format: </p>
<ul>
<li>1 byte flags: </li>
<li>7: Sign bit </li>
<li>4-6: Reserved for kernel </li>
<li>0-3: Available for program use </li>
<li>1 byte signed exponent, normalized to 0x80 instead of 0 </li>
<li>7 byte mantissa, BCD encoded with two digits per byte</li>
</ul>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="strtofp" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#strtofp">strtofp</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/3f0f38de0755b2975a7fe5d3c3a63af39fb76d3d/src/02/fp-math.asm#L124">View Source</a></small>
                    </h2>
                    
                    <p>Converts an ASCII-encoded signed decimal into a floating-point binary coded decimal format and stores it to the buffer at HL.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IX</dt>
                                <dd><p>Pointer to string</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Pointer to 9-byte destination buffer</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Output</h3>
                        
                            <p>Z: Set on success, reset on error</p>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>See <code>itofp</code> for the result format. </p>
<p>Only the first 14 significant digits are converted. The rest are truncated 
 but still used for exponent calculation. </p>
<p>In case of error, the destination buffer's contents are undefined. </p>
<p>The destination buffer must be zeroed before calling strtofp.</p>
                        
                    
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    <div class="col-md-4">
        <h4>Function Reference</h4>
        <ul class="nav doc-nav">
            
            
            <li><a href="/documentation/reference/color.html">Color</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/concurrency.html">Concurrency</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/cryptography.html">Cryptography</a></li>
            
            </li>
            
            
            <li class="active">
                <a href="/documentation/reference/decimal_floating_point.html" class="text-bold">Decimal Floating Point</a>
                <ul class="nav doc-nav">
                    
                    <li>
                        <a href="#fpAbs" class="text-muted">fpAbs</a>
                    </li>
                    
                    <li>
                        <a href="#fpAdd" class="text-muted">fpAdd</a>
                    </li>
                    
                    <li>
                        <a href="#fpAnd" class="text-muted">fpAnd</a>
                    </li>
                    
                    <li>
                        <a href="#fpCompare" class="text-muted">fpCompare</a>
                    </li>
                    
                    <li>
                        <a href="#fpFPart" class="text-muted">fpFPart</a>
                    </li>
                    
                    <li>
                        <a href="#fpIPart" class="text-muted">fpIPart</a>
                    </li>
                    
                    <li>
                        <a href="#fpLdConst" class="text-muted">fpLdConst</a>
                    </li>
                    
                    <li>
                        <a href="#fpMax" class="text-muted">fpMax</a>
                    </li>
                    
                    <li>
                        <a href="#fpMin" class="text-muted">fpMin</a>
                    </li>
                    
                    <li>
                        <a href="#fpMulPow10" class="text-muted">fpMulPow10</a>
                    </li>
                    
                    <li>
                        <a href="#fpNeg" class="text-muted">fpNeg</a>
                    </li>
                    
                    <li>
                        <a href="#fpNot" class="text-muted">fpNot</a>
                    </li>
                    
                    <li>
                        <a href="#fpOr" class="text-muted">fpOr</a>
                    </li>
                    
                    <li>
                        <a href="#fpRand" class="text-muted">fpRand</a>
                    </li>
                    
                    <li>
                        <a href="#fpSub" class="text-muted">fpSub</a>
                    </li>
                    
                    <li>
                        <a href="#fpXor" class="text-muted">fpXor</a>
                    </li>
                    
                    <li>
                        <a href="#fptostr" class="text-muted">fptostr</a>
                    </li>
                    
                    <li>
                        <a href="#itofp" class="text-muted">itofp</a>
                    </li>
                    
                    <li>
                        <a href="#strtofp" class="text-muted">strtofp</a>
                    </li>
                    
                </ul>
            </li>
            
            </li>
            
            
            <li><a href="/documentation/reference/display.html">Display</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/filestreams.html">Filestreams</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/filesystem.html">Filesystem</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/flash.html">Flash</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/hardware.html">Hardware</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/i_o.html">I/O</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/input.html">Input</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/maths.html">Maths</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/miscellaneous.html">Miscellaneous</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/strings.html">Strings</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/system.html">System</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/text.html">Text</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/threading.html">Threading</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/time.html">Time</a></li>
            
            </li>
            
        </ul>
    </div>
</div>
<script type="text/javascript">

</script>