---
# This page was generated by a tool - https://github.com/KnightOS/kdoc
title: I/O Documentation
layout: documentation
---



<div class="row">
    <div class="col-md-8">
        <h1>I/O</h1>
        <div class="docs">
            
            <div id="ioRegisterHandler" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#ioRegisterHandler">ioRegisterHandler</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/b89adc1c097314ec0c7432c07afecc0dfe134710/src/00/link.asm#L75">View Source</a></small>
                    </h2>
                    
                    <p>Registers an I/O packet handler for a given machine ID.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>A</dt>
                                <dd><p>Machine ID</p></dd>
                                
                                <dt>IX</dt>
                                <dd><p>Callback</p></dd>
                                
                                <dt>B</dt>
                                <dd><p>Expected header length</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>The "expected header length" is the length of the packet header at the time 
 you want your callback told about it. The maximum is 4. </p>
<p>Your callback will be called with HL set to the address of the packet header. </p>
<p>Your callback will be called during an interrupt, so make it short and sweet. 
 If you return HL != 0 and BC != 0, we'll assume that HL is a pointer to a 
 buffer to be filled with BC bytes from the rest of the packet. You may set IX 
 to a callback to run when the full packet is read, or to 0 otherwise. </p>
<p>If a handler has already been reserved with this machine ID, it will take 
 precedence. </p>
<p>Your header handler may be called multiple times before the final callback is 
 invoked. This may occur if we have to retry the packet due to a corrupted 
 header.</p>
                        
                    
                    </div>
                </div>
            </div>
            
            <div id="ioSendPacket" class="docsection">
                <div>
                    <h2 class="doc-title">
                        <a href="#ioSendPacket">ioSendPacket</a>
                        <small><a target="_blank" href="https://github.com/KnightOS/kernel/blob/b89adc1c097314ec0c7432c07afecc0dfe134710/src/00/link.asm#L132">View Source</a></small>
                    </h2>
                    
                    <p>Sends a DBus packet via the I/O port.</p>

                    <div class="details">
                    
                    
                        <h3>Inputs</h3>
                        
                            <dl>
                                
                                <dt>IX</dt>
                                <dd><p>Callback (or zero)</p></dd>
                                
                                <dt>E</dt>
                                <dd><p>Machine ID</p></dd>
                                
                                <dt>D</dt>
                                <dd><p>Command ID</p></dd>
                                
                                <dt>HL</dt>
                                <dd><p>Buffer (or zero)</p></dd>
                                
                                <dt>BC</dt>
                                <dd><p>Buffer length (or zero)</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Outputs</h3>
                        
                            <dl>
                                
                                <dt>Z</dt>
                                <dd><p>Set if successful, reset if I/O is busy</p></dd>
                                
                            </dl>
                        
                    
                    
                        <h3>Notes</h3>
                        
                            <p>This is an asyncronous operation. Your callback will be invoked 
 (outside the context of your thread) when the send is complete. 
 Please keep your callback short and sweet, as it will be called 
 during an interrupt. You are advised to suspend your main thread 
 or use <a href="concurrency.html#condWait">condWait</a> and have your callback resume/notify it. </p>
<p>Attempts to access the buffer memory before the callback is run 
 will end in tears.</p>
                        
                    
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    <div class="col-md-4">
        <h4>Function Reference</h4>
        <ul class="nav doc-nav">
            
            
            <li><a href="/documentation/reference/color.html">Color</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/concurrency.html">Concurrency</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/cryptography.html">Cryptography</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/display.html">Display</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/filestreams.html">Filestreams</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/filesystem.html">Filesystem</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/flash.html">Flash</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/hardware.html">Hardware</a></li>
            
            </li>
            
            
            <li class="active">
                <a href="/documentation/reference/i_o.html" class="text-bold">I/O</a>
                <ul class="nav doc-nav">
                    
                    <li>
                        <a href="#ioRegisterHandler" class="text-muted">ioRegisterHandler</a>
                    </li>
                    
                    <li>
                        <a href="#ioSendPacket" class="text-muted">ioSendPacket</a>
                    </li>
                    
                </ul>
            </li>
            
            </li>
            
            
            <li><a href="/documentation/reference/input.html">Input</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/maths.html">Maths</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/miscellaneous.html">Miscellaneous</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/strings.html">Strings</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/system.html">System</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/text.html">Text</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/threading.html">Threading</a></li>
            
            </li>
            
            
            <li><a href="/documentation/reference/time.html">Time</a></li>
            
            </li>
            
        </ul>
    </div>
</div>
<script type="text/javascript">

</script>